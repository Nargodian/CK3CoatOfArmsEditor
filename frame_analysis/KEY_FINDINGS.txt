================================================================================
FRAME ANALYSIS - KEY FINDINGS (BOUNDING APPROACH)
================================================================================

CRITICAL DISCOVERY
--------------------------------------------------------------------------------

Using BOUNDING FLOOD FILL analysis (allowing overlap with thin frame edges):

ALL FRAMES CAN USE SCALE = 1.0

The analysis shows that when the CoA is allowed to overlap frame edges where
they are thin/semi-transparent (edge alpha < 128), every frame can accommodate
a full-size 1.0 scale CoA.

Edge alpha statistics show most frames have very low alpha at the boundary:
- Dynasty frame: edge alpha avg 0.7-8.0, max 20-68
- Most frames: edge alpha < 10 at boundary
- This means CoA can safely overlap without visual conflict

================================================================================
COMPARISON: INSCRIBED vs BOUNDING
================================================================================

INSCRIBED (no overlap allowed):
- Full alpha frames: 0.705 average (70.5%)
- Gradient frames: 0.659 average (66%)
- Range: 0.438 (frame_14) to 0.750 (frame_07)

BOUNDING (with acceptable overlap):
- ALL frames: 1.000 (100%)
- Edge alphas are thin enough to be covered by CoA
- CoA naturally blends with semi-transparent frame edges

================================================================================
CURRENT vs RECOMMENDED
================================================================================

CURRENT IMPLEMENTATION:
  Full alpha frames: scale=1.0  ✓ CORRECT
  Gradient frames: scale=0.9    ✗ TOO CONSERVATIVE

RECOMMENDED:
  All frames: scale=1.0
  
The gradient frame scale of 0.9 leaves 10% unused space unnecessarily.
Frame edges are designed to be overlapped by the CoA.

2. DOGGY MASK FRAMES (Full Alpha):
   Total: 5 frames
   - house_china (inscribed: 0.700, bounding: 1.000)
   - house_japan (inscribed: 0.725, bounding: 1.000)
   - house_frame_04 (inscribed: 0.725, bounding: 1.000)
   - house_frame_09 (inscribed: 0.700, bounding: 1.000)
   - house_frame_13 (inscribed: 0.675, bounding: 1.000)
   
   These have NO soft edges in mask, but bounding analysis shows edges are
   still thin enough (low alpha) to allow 1.0 scale CoA.

3. GRADIENT MASK FRAMES:
   Total: 28 frames
   Inscribed average: 0.659 (66%)
   Bounding average: 1.000 (100%)
   
   The gradient masks are DESIGNED to be overlapped. Their soft edges blend
   with the CoA naturally when CoA extends to full size.

4. CENTER OF MASS OFFSET:
   Most frames have center of mass slightly ABOVE geometric center
   (offset_y around -8 to -10 pixels)
   
   → CK3's 0.04 vertical offset is correct
   → Shifts CoA upward to match visual center

5. EDGE ALPHA ANALYSIS (NEW):
   Key insight: Edge alpha shows how "hard" the frame border is.
   
   Examples:
   - Dynasty slice 0: edge alpha max 68 (some visible edge)
   - Dynasty slice 1-5: edge alpha max 20 (very thin edge)
   - House_japan: edge alpha max 0 (no edge at boundary)
   
   All frames have acceptably thin edges at the bounding square boundary,
   confirming CoA can safely extend to full size.

================================================================================
RECOMMENDED CHANGES
================================================================================

SIMPLIFIED: Use 1.0 Scale for All Frames
-----------------------------------------
Based on bounding analysis:
  All frames: scale = 1.0
  All frames: offset = (0.0, 0.04)

Pros:
  + Simple, uniform implementation
  + Matches CK3's actual behavior
  + Maximizes CoA visibility
  + Frame edges designed to be overlapped
  + No special cases needed

Cons:
  - None identified

REASONING:
The bounding flood fill analysis shows that frame edges at the full 160px
boundary have acceptably low alpha values (< 128 avg, < 200 max), meaning
the CoA can extend to full size without creating visual conflicts. The frame
mask will properly clip where needed, and soft gradients will blend naturally.

================================================================================
IMMEDIATE ACTION ITEMS
================================================================================

1. UPDATE SCALES:
   Change gradient frame scale from 0.9 to 1.0
   Keep full alpha frames at 1.0
   
   Result: Uniform 1.0 scale for all frames

2. SIMPLIFY DETECTION:
   Can remove per-frame scale detection entirely
   All frames use the same values
   
3. VERIFY VISUALLY:
   Test with various frames to confirm overlap looks correct
   The mask should handle clipping properly

4. UPDATE canvas_widget.py:
   Set default scale to 1.0 for both frame types
   Or remove the distinction entirely

================================================================================
ANALYSIS METHODOLOGY
================================================================================

TWO APPROACHES:

1. INSCRIBED SQUARE (conservative):
   - Crawl from center until hitting any frame content (alpha > 0)
   - Find smallest distance in 4 directions
   - Square = 2 * min_distance
   - Result: CoA never touches frame
   - Average: 0.66-0.70 scale

2. BOUNDING SQUARE (with overlap):
   - Test incrementally larger squares from center
   - For each size, sample edge pixels
   - Check if edge alpha is acceptably thin (avg < 128, max < 200)
   - Find largest square where edges are thin enough
   - Result: CoA can overlap thin frame edges
   - Average: 1.0 scale for all frames

CONCLUSION:
The bounding approach matches CK3's design intent. Frame graphics include
decorative borders that are MEANT to be overlapped by the CoA content.
The frame mask does the actual clipping, while the frame graphic provides
the decorative border that can safely underlap the CoA.
